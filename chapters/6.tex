% !TEX encoding = UTF-8
% !TEX TS-program = pdflatex
% !TEX root = ../arsclassica.tex
% !TEX spellcheck = it-IT

%************************************************
\chapter{Esperimenti numerici}\label{cap:esperimenti}
%************************************************
\omissis{}
% introdurre argomenti del capitolo (dataset, e quindi tsis + sperimentazione)
% introdurre modalità di sperimentazione
% introdurre cross-validation
% spiegare metriche di valutazione utilizzate? si! ma in capitolo 4!

\section{\Ds{1}}\label{sec:dataset-1}
Lo scopo di questa sezione è presentare il \ds{1} e i risultati di classificazione e apprendimento strutturale ottenuti (si vedano rispettivamente i~\vref{cap:ctbnc,cap:structurallearning}) utilizzando tale insieme di \emph{\keyword{dati completi}} come input.

\subsection{Modello TSIS}\label{subsec:tsis-simple-model}
Al fine di introdurre il \ds{1} è necessario presentare la rete stradale \acs{TSIS} e il relativo modello di simulazione \acs{CORSIM} da cui esso è stato generato.

La~\vref{fig:tsis-model-simple} mostra la rete stradale che compone il modello \acs{TSIS} oggetto di questa sottosezione. Tale figura evidenzia:
\begin{itemize}
	\item la disposizione dei sensori (indicati tramite degli indici numerici di colore giallo) utilizzati per il monitoraggio del passaggio dei veicoli
	\item le strade, tutte composte da $2$ corsie, e i nodi (indicati tramite degli indici numerici di colore bianco) da cui è composta la rete stradale
	\item i sensi di marcia delle corsie
	\item le intersezioni controllate tramite semafori (\ie{} nodi con indici $02$, $03$ e $04$).
\end{itemize}
Di seguito si riportano le ulteriori caratteristiche di tale rete stradale:
\begin{itemize}
	\item la larghezza delle corsie è \num{3.65} \si{\metre}
	\item la lunghezza della strada principale (\ie{} da nodo $1$ a nodo $5$) è \num{780} \si{\metre} mentre la lunghezza delle strade ad essa perpendicolari è pari a \num{300} \si{\metre}
	\item la dimensione dei sensori è \num{0.30} \si{\metre}, da cui consegue che la dimensione della zona sensibile (in tutte le direzioni) è \num{1.85} \si{\metre}
	\item la distanza dei sensori dal nodo più vicino è \num{6.5} \si{\metre}
\end{itemize}

\begin{figure}
  	\centering
  	\includegraphics[max size={0.9\textwidth}{0.9\textheight}]{tsis-model-simple}% 
  	\caption[Rete stradale del \ds{1}]{Visualizzazione del file \acs{TNO} rappresentante la rete stradale da cui viene generato il \ds{1}. I sensori sono etichettati tramite degli indici numerici di colore giallo mentre i nodi sono etichettati tramite degli indici numerici di colore bianco.}
	\label{fig:tsis-model-simple}
\end{figure}

Il modello di simulazione \acs{CORSIM} prevede un tempo di simulazione pari a $24$ ore, suddiviso in $16$ \emph{\keyword{time period}}, ognuno dei quali composto da \emph{\keyword{time interval}} della durata di $1$ secondo: la~\vref{tab:ds-1-tp-labels} illustra la durata (in ore) di ognuno di essi e introduce la corrispondenza fra essi e la fase della giornata, rappresentata come la variabile classe nel relativo dataset.
\begin{table}[htbp]%
	\centering%
	\begin{tabular}{+l^l^l^l}
	\toprule\rowstyle{\bfseries}%
	Fascia oraria  		   & Time Period  	& Fase          & Classe  \\\otoprule
	$07$:$00$ - $08$:$00$  & $1$            & mattino       & $1$     \\
	$08$:$00$ - $09$:$00$  & $2$            & mattino       & $1$     \\
	$09$:$00$ - $10$:$00$  & $3$            & mattino       & $1$     \\
	$10$:$00$ - $12$:$00$  & $4$            & giorno        & $2$     \\
	$12$:$00$ - $14$:$00$  & $5$            & giorno        & $2$     \\
	$14$:$00$ - $16$:$00$  & $6$            & giorno        & $2$     \\
	$16$:$00$ - $17$:$00$  & $7$            & giorno        & $2$     \\
	$17$:$00$ - $18$:$00$  & $8$            & pomeriggio    & $3$     \\
	$18$:$00$ - $19$:$00$  & $9$            & pomeriggio    & $3$     \\
	$19$:$00$ - $20$:$00$  & $10$           & pomeriggio    & $3$     \\
	$20$:$00$ - $22$:$00$  & $11$           & sera          & $4$     \\
	$22$:$00$ - $24$:$00$  & $12$           & sera          & $4$     \\
	$00$:$00$ - $02$:$00$  & $13$           & notte         & $5$     \\
	$02$:$00$ - $04$:$00$  & $14$           & notte         & $5$     \\
	$04$:$00$ - $05$:$00$  & $11$           & notte         & $5$     \\
	$05$:$00$ - $07$:$00$  & $16$           & alba          & $6$     \\\bottomrule
	\end{tabular}
	\caption[Periodi temporali del \ds{1}]{Caratterizzazione dei periodi temporali (\ie{} \emph{\keyword{time period}}) del modello \acs{TSIS} relativo al \ds{1}.}
	\label{tab:ds-1-tp-labels}
\end{table}

Ogni fase della giornata (\ie{} classe) è caratterizzata da un andamento diverso del traffico:
\begin{itemize}
	\item al mattino traffico intenso su tutta la rete stradale e code in direzione del nodo $5$ 
	\item durante il giorno traffico moderato su tutta la rete e code residue verso il nodo $5$ nella prima parte di tale fase
	\item nel pomeriggio traffico intenso su tutta la rete stradale e code in direzione del nodo $1$
	\item durante la sera traffico moderato su tutta la rete stradale e code residue verso il nodo $1$ nella prima parte di tale fase
	\item pochi veicoli in tutte le direzioni durante la notte
	\item all'alba aumento dei veicoli diretti verso il nodo $5$
\end{itemize}

L'andamento del traffico è modellato in \acs{CORSIM} variando i flussi di ingresso dei veicoli e le percentuali di svolta nelle varie intersezioni al variare dei periodi temporali. La~\vref{tab:ds-1-input-vehicles} illustra i flussi di ingresso, espressi come numero di veicoli orari (\ie{} \si{vph}), dei veicoli nella rete stradale per ogni fase della simulazione. Si osservi che l'immissione di veicoli sulla rete stradale avviene seguendo una distribuzione di probabilità di Erlang con parametro \emph{shape} pari a $2$. 
\begin{table}[H]
	\centering
	\begin{tabular}{+l^c^c^c}
	\toprule\rowstyle{\bfseries}%
	Fase 		& $01 \rightarrow 05$ & $05 \rightarrow 01$ & Strade secondarie	\\
				& \si{vph}			  & \si{vph}			& \si{vph}			\\\otoprule
	mattino		& $600$ 			  & $200$			  	& $100$				\\
	giorno 		& $300$				  & $300$			    & $50$				\\
	pomeriggio	& $200$				  & $600$			    & $100$				\\
	sera 		& $100$				  & $200$			    & $50$				\\
	notte 		& $50$				  & $50$			    & $25$				\\
	alba		& $200$				  & $100$			    & $50$				\\\bottomrule
	\end{tabular}
	\caption[ABC]{ABC.}
	\label{tab:ds-1-input-vehicles}
\end{table}

La~\vref{tab:ds-1-turning-movs} illustra invece le percentuali di svolta ad ogni intersezione al variare della fase della giornata: l'intestazione di tale tabella indica il nodo di provenienza dei veicoli mentre le celle indicano la distribuzione delle svolte che tali veicoli effettuano nell'intersezione che segue il nodo di partenza. Ad esempio, \omissis{}

\begin{sidewaystable}[htbp]
	\centering
	\begin{tabular}{+l^c^c^c^c^c^c^c^c^c^c^c^c^c^c^c^c^c^c^c^c^c}
	\toprule\rowstyle{\bfseries}%
	Dal/i nodo/i	& \multicolumn{3}{c}{$01$} & \multicolumn{3}{c}{$02$} & \multicolumn{3}{c}{$03$} & \multicolumn{3}{c}{$04$} & \multicolumn{3}{c}{$05$} & \multicolumn{3}{c}{$06$ - $08$ - $10$} & \multicolumn{3}{c}{$07$ - $09$ - $11$} \\
	& & \% &
	& & \% &
	& & \% &
	& & \% &
	& & \% &
	& & \% &
	& & \% &\\
	& $\hookleftarrow$ & $\hookrightarrow$ & $\downarrow$
	& $\hookleftarrow$ & $\hookrightarrow$ & $\downarrow$
	& $\hookleftarrow$ & $\hookrightarrow$ & $\downarrow$
	& $\hookleftarrow$ & $\hookrightarrow$ & $\downarrow$
	& $\hookleftarrow$ & $\hookrightarrow$ & $\downarrow$
	& $\hookleftarrow$ & $\hookrightarrow$ & $\downarrow$
	& $\hookleftarrow$ & $\hookrightarrow$ & $\downarrow$\\\otoprule
	mattino 	& $10$ & $10$ & $80$ & $10$ & $10$ & $80$ & $10$ & $10$ & $80$ &  ?  &  ?  &  ?  &  ?  &  ?  &  ?  & $80$ & $10$ & $10$ & $10$ & $80$ & $10$ \\
	giorno  	&  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? \\
	pomeriggio 	&  ?   &  ?   &  ?   &  ?   &  ?   &  ?   & $10$ & $10$ & $80$ & $10$ & $10$ & $80$ & $10$ & $10$ & $80$ & $10$ & $80$ & $10$ & $80$ & $10$ & $10$ \\
	sera 		&  ?   &  ?   &  ?   &  ?   &  ?   &  ?   & $20$ & $20$ & $60$ & $20$ & $20$ & $60$ & $20$ & $20$ & $60$ & $20$ & $60$ & $20$ & $60$ & $20$ & $20$ \\
	notte 		& $33$ & $33$ & $33$ &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? &  ? \\
	alba 		& $20$ & $20$ & $80$ & $20$ & $20$ & $80$ &  ?   &   ?  &   ?  &  ?  &  ?  &  ?  &  ?  &  ?  &  ?  & $80$ & $10$ & $10$ & $10$ & $80$ & $10$ \\\bottomrule
	\end{tabular}
	\caption[ABC]{ABC.}
	\label{tab:ds-1-turning-movs}
\end{sidewaystable}

La rete stradale non include attraversamenti pedonali. Ne consegue che il modello di simulazione non prevede la generazione di traffico pedonale casuale.

	%\item la velocità media dei veicoli su tutte le strade è $48$ \si{km/h}

\begin{table}[htbp]%
	\centering%
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\# & Sensore  \\\otoprule
	$01$& D$212$\\
	$02$& D$121$\\
	$03$& D$272$\\
	$04$& D$721$\\
	$05$& D$392$\\
	$06$& D$931$\\
	$07$& D$4412$\\
	$08$& D$1141$\\
	$09$& D$452$\\
	$10$& D$541$\\\bottomrule
	\end{tabular}
	\hspace{-0.6em}
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\# & Sensore  \\\otoprule
	$11$& D$4102$\\
	$12$& D$1041$\\
	$13$& D$382$\\
	$14$& D$831$\\
	$15$& D$262$\\
	$16$& D$621$\\
	$17$& D$211$\\
	$18$& D$122$\\
	$19$& D$271$\\
	$20$& D$722$\\\bottomrule
	\end{tabular}
	\hspace{-0.6em}
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\# & Sensore  \\\otoprule
	$21$& D$231$\\
	$22$& D$322$\\
	$23$& D$261$\\
	$24$& D$622$\\
	$25$& D$321$\\
	$26$& D$232$\\
	$27$& D$391$\\
	$28$& D$932$\\
	$29$& D$341$\\
	$30$& D$432$\\\bottomrule
	\end{tabular}
	\hspace{-0.6em}
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\# & Sensore  \\\otoprule
	$31$& D$381$\\
	$32$& D$832$\\
	$33$& D$431$\\
	$34$& D$342$\\
	$35$& D$4111$\\
	$36$& D$1142$\\
	$37$& D$451$\\
	$38$& D$542$\\
	$39$& D$4101$\\
	$40$& D$1042$\\\bottomrule
	\end{tabular}
	\caption[Sensori del \ds{1}]{Corrispondenza fra gli identificatori dei sensori del \ds{1} e l'indice con cui essi sono indicati nella~\autoref{fig:tsis-model-simple}.}
	\label{tab:ds-1-sensors-indices}
\end{table}

%immagine piano semaforico? no
%dire che ci sono (e dove sono) i semafori (l'immagine non li contiene), al massimo incollarli sull'immagine ...
%spiegare come è fatta la rete stradale e modello di simulazione del traffico: time period, semafori, come va il traffico durante i time period

\subsection{Risultati}
\omissis{}
Prova~\vref{fig:tsis-model-monza-nodes} ...

%see: https://gist.github.com/leodido/5990626

\section{\Ds{2}}\label{sec:dataset-2}
\omissis{}

\subsection{Modello TSIS}\label{subsec:tsis-monza-model}
\omissis{}

% dire che parte da uno studio già fatto con sensori reali, riprodotto in tsis e esteso con altri sensori da me

\begin{table}[htbp]%
	\centering%
	\begin{tabular}{+l^l^l^l}
	\toprule\rowstyle{\bfseries}%
	Fascia oraria  		   & Time Period  	& Fase          & Classe  \\\otoprule
	$00$:$00$ - $02$:$05$  & $1$            & notte         & $1$     \\
	$02$:$05$ - $04$:$10$  & $2$            & notte         & $1$     \\
	$04$:$10$ - $06$:$15$  & $3$            & alba          & $2$     \\
	$06$:$15$ - $08$:$20$  & $4$            & mattino       & $3$     \\
	$08$:$20$ - $10$:$25$  & $5$            & mattino       & $3$     \\
	$10$:$25$ - $12$:$30$  & $6$            & giorno        & $4$     \\
	$12$:$30$ - $14$:$35$  & $7$            & giorno        & $4$     \\
	$14$:$35$ - $16$:$40$  & $8$            & giorno        & $4$     \\
	$16$:$40$ - $18$:$45$  & $9$            & pomeriggio    & $5$     \\
	$18$:$45$ - $20$:$50$  & $10$           & pomeriggio    & $5$     \\
	$20$:$50$ - $22$:$55$  & $11$           & sera          & $6$     \\
	$22$:$55$ - $24$:$00$  & $12$           & sera          & $6$     \\\bottomrule
	\end{tabular}
	\caption[Periodi temporali del \ds{2}]{Caratterizzazione dei periodi temporali (\ie{} \emph{\keyword{time period}}) del modello \acs{TSIS} relativo al \ds{2}.}
	\label{tab:ds-2-tp-labels}
\end{table}
%Saturday classes: `11`, `12`, ..., `16`.

%\cleardoublepage
%\begin{center}
%\capfigure
%\captionsetup{type=figure}
%\captionsetup[subfigure]{labelformat=empty}
%\subfloat[]{\includegraphics[width=1\columnwidth]{tsis-model-monza-gmap-dx}}\cleardoublepage
%\subfloat[]{\includegraphics[width=1\columnwidth]{tsis-model-monza-gmap-sx}}
%\captionof{figure}[Intersezioni della rete stradale del \ds{2}]{Visualizzazione del file \acs{TNO} rappresentante le intersezioni della rete stradale da cui viene generato il \ds{2}.}
%\label{fig:tsis-model-monza-nodes}
%\end{center}

\begin{figure}[ht]
  \centering
  \captionsetup[subfigure]{labelformat=empty}
  \subfloat[][]{\includegraphics[width=0.935\columnwidth]{tsis-model-monza-gmap-dx}}%
  \phantomcaption
  \label{fig:tsis-model-monza-nodes}
\end{figure}
\begin{figure}[!t]
  \centering
  \captionsetup{type=figure}
  \captionsetup[subfigure]{labelformat=empty}
  \subfloat[][]{\includegraphics[width=0.935\columnwidth]{tsis-model-monza-gmap-sx}}% 
  \caption[Intersezioni della rete stradale del \ds{2}]{Visualizzazione del file \acs{TNO} rappresentante le intersezioni della rete stradale da cui viene generato il \ds{2}.}
\end{figure} 

\begin{table}[htbp]%
	\centering%
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	Nodo    & Nome intersezione/strada\\\otoprule
	$1$     & dante                 \\
	$2$     & villa                 \\
	$3$     & viale brianza         \\
	$4$     & boccaccio             \\
	$5$     & via boccaccio         \\
	$6$     & p.zza citterio        \\
	$7$     & viale cesare battisti \\
	$8$     & boito                 \\
	$9$     & volta                 \\
	$10$    & via dante alighieri   \\
	$11$    & via g. rossini        \\
	$12$    & via donizzetti        \\
	$13$    & via a. volta          \\
	$14$    & via tognetti          \\
	$16$    & via boito             \\\bottomrule
	\end{tabular}
	\caption[Intersezioni del \ds{2}]{Caratterizzazione degli identificatori delle intersezioni (o nodi) del \ds{2}.}
	\label{tab:ds-2-nodes}
\end{table}

% inserire nomi vie visibili
\begin{figure}[ht]
  	\centering
  	\includegraphics[width=1\columnwidth]{tsis-model-monza-compact}% 
  	\caption[Rete stradale del \ds{2}]{Visualizzazione del file \acs{TNO} rappresentante la rete stradale da cui viene generato il \ds{2}.}
	\label{fig:tsis-model-monza}
\end{figure} 

%TODO: migliorare ..
Di seguito si elencano le informazioni dei sensori reali del modello in questione:
\begin{description}
\item[$5094$] \hfill \\
Rilevamento dei veicoli provenienti da P.zza Citterio.
\item[$5095$] \hfill \\
Rilevamento dei veicoli provenienti dall'intersezione \virgolette{Boccaccio} diretti verso il centro di Monza.
\item[$5096$] \hfill \\
Rilevamento dei veicoli provenienti da Brianza verso Vedano.
\item[$5097$] \hfill \\
Rilevamento dei veicoli provenienti Regina Margherita che svoltano a sinistra in Battisti.
\item[$5098$] \hfill \\
Rilevamento dei veicoli provenienti da Battisti che svoltano a sinistra verso Vedano.
\item[$5099$] \hfill \\
Rilevamento dei veicoli provenienti da Battisti diretti verso il centro di Monza.
\end{description}

I sensori non reali aggiunti alla rete stradale che simula questa situazione di traffico reale vengono identificati secondo uno schema ben preciso. Il loro identificatore è composto in base al senso di marcia. Nello specifico tale numero è una concatenazione dei seguenti valori: identificatore dell'intersezione di partenza, identificatore dell'intersezione d'arrivo, numero indicante la corsia su cui il sensore è posto (\ie{} $0$ se è la strada possiede una sola corsia, $1$ o $2$ se il sensore è posto rispettivamente a destra o a sinitra, $7$ o $8$ nel caso in cui esso sia posto su ulteriori corsie di destra o sinistra). Ad esempio:
\begin{itemize}
\item il sensore identificato da D$912$ è posto sulla corsia di sinistra della strada che collega l'intersezione \virgolette{Volta} (\ie{} nodo $9$) all'intersezione \virgolette{Dante} (\ie{} nodo $1$)
\item il sensore identificato da D$1480$ è posto sull'unica corsia di \virgolette{Via Tognetti} (\ie{} nodo $14$) nei pressi dell'incrocio con l'intersezione \virgolette{Boito} (\ie{} nodo $8$).
\end{itemize}

\begin{table}[htbp]%
	\centering%
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\#  & Sensore \\\otoprule
	$01$& D$782$       \\
	$02$& D$781$       \\
	$03$& D$1687$      \\
	$04$& D$1681$      \\
	$05$& D$1682$      \\
	$06$& D$981$       \\
	$07$& D$982$       \\
	$08$& D$1480$      \\\bottomrule
	\end{tabular}
	\hspace{-0.6em}
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\#  & Sensore \\\otoprule
	$09$& D$892$       \\
	$10$& D$891$       \\
	$11$& D$192$       \\
	$12$& D$191$       \\
	$13$& D$1290$      \\
	$14$& D$912$       \\
	$15$& D$911$       \\
	$16$& D$1092$      \\\bottomrule
	\end{tabular}
	\hspace{-0.6em}
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\#  & Sensore \\\otoprule
	$17$& D$1091$      \\
	$18$& D$212$       \\
	$19$& D$211$       \\
	$20$& D$110$       \\
	\color{red}$21$& D$5098*$     \\
	\color{red}$22$& D$5099*$     \\
	\color{red}$23$& D$5097*$     \\
	$24$& D$421$       \\\bottomrule
	\end{tabular}
	\hspace{-0.6em}
	\begin{tabular}{+l^l}
	\toprule\rowstyle{\bfseries}%
	\#  & Sensore \\\otoprule
	\color{red}$25$& D$5096*$     \\
	$26$& D$321$       \\
	$27$& D$241$       \\
	$28$& D$242$       \\
	\color{red}$29$& D$5094*$     \\
	$30$& D$642$       \\
	\color{red}$31$& D$5095*$     \\
	$32$& D$541$       \\\bottomrule
	\end{tabular}
	\caption[Sensori del \ds{2}]{Corrispondenza fra gli identificatori dei sensori del \ds{2} e l'indice con cui essi sono indicati nella \omissis{}}
	\label{tab:ds-2-sensors-indices}
\end{table}

Nella~\vref{tab:ds-2-sensors-indices}, i sensori il cui identificatore è contrassegnato da un asterisco corrispondono ai sensori reali, evidenziati anche nella figura \omissis{} tramite un indice numerico di colore rosso.

%varianti del dataset utilizzate
%split figure on more pages (search google is my friend)

\subsection{Risultati}
\omissis{}



%see: https://gist.github.com/leodido/5733991

%risultati:
%apprendimento
%classificazione (cross-validated)
%apprendimento strutturale (cross-validated)